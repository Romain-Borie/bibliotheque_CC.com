<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title | escape }}</title>
  <style>
    /* Base (sobre) */
    html, body { margin:0; background:#fff; color:#111; font-family:Verdana, system-ui, -apple-system, Segoe UI, Roboto, Arial; font-size:12pt; line-height:1.6; }
    header.topbar { position:sticky; top:0; z-index:1000; background:#000; border-bottom:1px solid #1a1a1a; }
    .topbar-inner { padding:10px 16px; display:flex; justify-content:center; }
    .site-title { margin:0; color:#fff; font-weight:500; letter-spacing:1px; }

    /* Layout simple (facultatif) */
    .app { display:flex; min-height:100vh; }
    aside.sidebar { width:240px; background:#fff; border-right:1px solid #e0e0e0; padding:12px 0; position:sticky; top:0; height:100vh; overflow-y:auto; overflow-x:visible; }
    main.content { flex:1; padding:24px 18px 56px; }

    /* Menu items (reprend ton style) */
    .menu { list-style:none; margin:0; padding:0; }
    .menu li { margin:2px 0; }
    a.sc-fqkvVR.dMxrQl { display:flex; align-items:center; gap:10px; padding:8px 16px; color:#333; text-decoration:none; border-left:3px solid transparent; }
    a.sc-fqkvVR.dMxrQl:hover { background:#f4f4f4; }
    a.sc-fqkvVR.dMxrQl.active { background:#1f8f4e; color:#fff; border-left-color:#156d3b; font-weight:600; }

    /* === Flyout au CLIC uniquement === */
    .has-flyout { position:relative; }

    /* Déclencheur = BUTTON */
    .group-trigger { width:100%; display:flex; align-items:center; gap:10px; padding:8px 16px; color:#333; background:transparent; border:0; text-align:left; cursor:pointer; font:inherit; border-left:3px solid transparent; }
    .group-trigger:hover { background:#f4f4f4; }
    .group-trigger .chevron { margin-left:auto; transition:transform .2s ease; }
    .has-flyout.open .group-trigger .chevron { transform:rotate(90deg); }

    /* Sous-menu flyout (caché par défaut) */
    .flyout { position:absolute; top:0; left:calc(100% - 2px); min-width:260px; background:#fff; border:1px solid #e0e0e0; box-shadow:0 6px 18px rgba(0,0,0,.12); border-radius:6px; padding:6px 0; list-style:none; margin:0; display:none; z-index:3000; }
    .has-flyout.open > .flyout { display:block; }
    .flyout a.sc-fqkvVR.dMxrQl { display:block; padding:8px 14px; white-space:nowrap; }

    /* Mobile : replie le sous-menu sous l'item */
    @media (max-width:700px){
      .app { flex-direction:column; }
      aside.sidebar { width:100%; border-right:0; border-bottom:1px solid #e0e0e0; height:auto; position:static; }
      .flyout { position:static; left:auto; top:auto; border:0; box-shadow:none; border-left:2px solid #eef2f7; margin-left:20px; }
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner"><h1 class="site-title">Bibliothèque de l'équipe CC</h1></div>
  </header>

  <div class="app">
    <aside class="sidebar" role="navigation" aria-label="Menu latéral">
      <ul class="menu">
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url == '/' or page.url contains '/tableau-de-bord/' %}active{% endif %}" href="/tableau-de-bord/">Tableau de bord</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/actualites-ccn/' %}active{% endif %}" href="/actualites-ccn/">Actualités CCN</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/astuces-romain/' %}active{% endif %}" href="/astuces-romain/">Les astuces de Romain</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/cuisine-cc/' %}active{% endif %}" href="/cuisine-cc/">Cuisine CC</a>
        </li>

        <!-- ITEM AVEC FLYOUT AU CLIC -->
        <li class="has-flyout">
          <button class="group-trigger" aria-haspopup="true" aria-expanded="false" type="button">
            <span>Simulateur</span>
            <span class="chevron" aria-hidden="true">▸</span>
          </button>
          <ul class="flyout" role="menu" aria-label="Sous-menu Simulateur">
            <li role="none"><a class="sc-fqkvVR dMxrQl {% if page.url contains '/simulateur/retraite/' %}active{% endif %}" href="{{ '/simulateur/retraite/' | relative_url }}" role="menuitem" {% if page.url contains '/simulateur/retraite/' %}aria-current="page"{% endif %}>Indemnité de départ à la retraite</a></li>
            <li role="none"><a class="sc-fqkvVR dMxrQl {% if page.url contains '/simulateur/divers/' %}active{% endif %}" href="{{ '/simulateur/divers/' | relative_url }}" role="menuitem" {% if page.url contains '/simulateur/divers/' %}aria-current="page"{% endif %}>Divers</a></li>
          </ul>
        </li>
        <!-- /ITEM AVEC FLYOUT AU CLIC -->

        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/dsn/' %}active{% endif %}" href="/dsn/">DSN</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/modules/' %}active{% endif %}" href="/modules/">Modules</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/etats-declarations/' %}active{% endif %}" href="/etats-declarations/">États et déclarations</a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/etats-controle/' %}active{% endif %}" href="/etats-controle/">États de contrôle</a>
        </li>
      </ul>
    </aside>

    <main class="content" role="main">
      {{ content }}
    </main>
  </div>

  <script>
    // Toggle au clic + fermeture clic extérieur + Échap + ARIA sync
    document.querySelectorAll('.has-flyout').forEach(group => {
      const trigger = group.querySelector('.group-trigger');
      const flyout  = group.querySelector('.flyout');

      const open = () => { group.classList.add('open'); trigger.setAttribute('aria-expanded','true'); };
      const close = () => { group.classList.remove('open'); trigger.setAttribute('aria-expanded','false'); };

      trigger.addEventListener('click', (e) => {
        e.preventDefault();
        group.classList.contains('open') ? close() : open();
      });

      document.addEventListener('click', (e) => {
        if (!group.contains(e.target)) close();
      });

      group.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });

      // Au chargement : ouvrir si un lien est actif
      if (flyout.querySelector('a.active')) open();
    });
  </script>
</body>
</html>
