<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title | escape }}</title>
  <!-- Styles INLINE (stables, pas de problème de cache/CSS) -->
  <style>
  /* ===== Barre noire ===== */
  header.topbar {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #000;
    border-bottom: 1px solid #1a1a1a;
  }
  header.topbar .topbar-inner {
    padding-block: clamp(6px, 0.8vw + 4px, 14px);
    padding-inline: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  /* ===== TITRE ===== */
  .site-title {
    color: #fff;
    font-size: 12.0pt; /* ta valeur personnalisée */
    letter-spacing: 1px;
    text-transform: none;
    font-family: Verdana;
    font-weight: 500;
    margin: 0;
  }
  /* ===== Contenu global ===== */
  html, body {
    margin: 0;
    background: #fff;
    color: #111;
    font-family: Verdana;
    font-size: 12.0pt; /* taille du site (hors titre) conservée */
    line-height: 1.6;
  }
  /* ===== Layout global ===== */
  .app {
    display: flex; /* sidebar + contenu côte à côte */
    min-height: calc(100vh - 0px);
  }
  /* ===== Sidebar ===== */
  aside.sidebar {
    width: 240px;
    background: #fff;
    border-right: 1px solid #e0e0e0;
    padding: 12px 0;
    position: sticky; top: 0;
    align-self: flex-start;
    height: calc(100vh - 0px);
    overflow-y: auto;
    overflow-x: visible; /* indispensable pour les flyouts */
    z-index: 30; /* au-dessus du contenu */
  }
  .menu { list-style: none; margin: 0; padding: 0; }
  .menu li { margin: 2px 0; }
  /* Bloc lien de menu — TES CLASSES */
  a.sc-fqkvVR.dMxrQl {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    color: #333;
    text-decoration: none;
    font-size: inherit; /* hérite de 12pt */
    border-left: 3px solid transparent;
  }
  a.sc-fqkvVR.dMxrQl:hover { background: #f4f4f4; }
  /* Icône (ton pattern) */
  .icon-style__StyledIcon-sc-74150e41-0.jEBroz {
    width: 18px; height: 18px; display: inline-block;
  }
  /* Actif (surlignage) */
  a.sc-fqkvVR.dMxrQl.active {
    background: #1f8f4e;
    color: #fff;
    border-left-color: #156d3b;
    font-weight: 600;
  }
  /* Contenu principal */
  main.content {
    flex: 1;
    padding: 24px 18px 56px;
    background: #fff;
  }
  main.content h1 { margin-top: 0; }
  /* Responsive simple */
  @media (max-width: 900px) { aside.sidebar { width: 200px; } }
  @media (max-width: 700px) {
    .app { flex-direction: column; }
    aside.sidebar {
      width: 100%;
      border-right: none;
      border-bottom: 1px solid #e0e0e0;
      position: static;
      height: auto;
    }
  }

  /* ===== Groupes avec sous-menus ===== */
  .menu .group {
    margin: 4px 0;
  }
  /* Bouton de groupe (même gabarit visuel que tes liens) */
  .menu-toggle {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    color: #333;
    background: transparent;
    border: 0;
    text-align: left;
    cursor: pointer;
    font: inherit;
    border-left: 3px solid transparent;
    border-radius: 0; /* garde l’aspect “lien” */
  }
  .menu-toggle:hover { background: #f4f4f4; }
  .menu-toggle:focus { outline: 2px solid #cde6d6; outline-offset: 2px; }
  /* Chevrons indicateurs */
  .menu-toggle .chevron {
    margin-left: auto;
    transition: transform .2s ease;
  }
  .menu-toggle[aria-expanded="true"] .chevron { transform: rotate(90deg); }
  /* Sous-menu (caché par défaut via [hidden]) */
  .submenu {
    list-style: none;
    margin: 2px 0 6px 0;
    padding: 0 0 0 20px; /* indentation visuelle */
    border-left: 2px solid #eef2f7;
  }
  .submenu li a.sc-fqkvVR.dMxrQl { padding-left: 8px; }
  /* Actif (hérite de ton style actif) */
  .submenu a.sc-fqkvVR.dMxrQl.active {
    background: #1f8f4e;
    color: #fff;
    border-left-color: #156d3b;
    font-weight: 600;
  }
  /* Actif pour le bouton de groupe */
  .menu-toggle.active {
    background: #1f8f4e;
    color: #fff;
    border-left-color: #156d3b;
    font-weight: 600;
  }
  /* Assure que les textes/chevrons héritent bien du blanc en actif */
  .menu-toggle.active .chevron,
  .menu-toggle.active span {
    color: inherit;
  }

  /* ===== Flyout à droite (ouverture au survol/focus) ===== */
  .has-flyout { position: relative; } /* référence de positionnement */
  /* Déclencheur (look proche de tes liens) */
  .group-trigger {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 16px;
    border-left: 3px solid transparent;
    cursor: pointer; /* meilleure affordance */
  }
  .group-trigger:hover { background: #f4f4f4; }
  .group-trigger:focus { outline: 2px solid #cde6d6; outline-offset: 2px; }
  .group-trigger .chevron { margin-left: auto; }

  /* PONT ANTI-PERTE DE HOVER */
  .has-flyout::after {
    content: "";
    position: absolute;
    top: 0;
    left: 100%;
    width: 16px;
    height: 100%;
  }

  /* Le flyout est masqué par défaut */
  .has-flyout .flyout {
    position: absolute;
    top: 0;
    left: calc(100% - 2px);
    min-width: 260px;
    background: #fff;
    border: 1px solid #e0e0e0;
    box-shadow: 0 6px 18px rgba(0,0,0,.12);
    border-radius: 6px;
    padding: 6px 0;
    list-style: none;
    margin: 0;
    display: none;
    z-index: 9999; /* très haut pour lever tout doute */
    pointer-events: auto;
  }

  .has-flyout .flyout a.sc-fqkvVR.dMxrQl {
    display: block;
    padding: 8px 14px;
    border-left: 3px solid transparent;
    white-space: nowrap;
  }

  /* OUVERTURE CSS : on blinde avec !important en cas de règle concurrente */
  .has-flyout:hover > .flyout,
  .has-flyout:focus-within > .flyout,
  .has-flyout .flyout:hover {
    display: block !important;
  }

  /* Si on est sur une page Simulateur, surligne le trigger (SSR via Liquid) */
  {% if page.url contains '/simulateur/' %}
  .has-flyout .group-trigger {
    background: #1f8f4e; color: #fff; border-left-color: #156d3b; font-weight: 600;
  }
  .has-flyout .group-trigger .chevron { color: inherit; }
  {% endif %}

  /* Mobile */
  @media (max-width: 700px) {
    .has-flyout .flyout {
      position: static;
      border: 0; box-shadow: none;
      border-left: 2px solid #eef2f7;
      margin-left: 20px;
      display: block !important;
      z-index: auto;
    }
  }
  </style>
</head>
<body>
  <!-- Barre horizontale noire -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <h1 class="site-title">Bibliothèque de l'équipe CC</h1>
    </div>
  </header>

  <!-- LAYOUT global : SIDEBAR + CONTENU -->
  <div class="app">
    <!-- SIDEBAR GAUCHE -->
    <aside class="sidebar" role="navigation" aria-label="Menu latéral">
      <ul class="menu">
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url == '/' or page.url contains '/tableau-de-bord/' %}active{% endif %}"
             href="/tableau-de-bord/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="home"></span>
            <span class="">Tableau de bord</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/actualites-ccn/' %}active{% endif %}"
             href="/actualites-ccn/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="page"></span>
            <span class="">Actualités CCN</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/astuces-romain/' %}active{% endif %}"
             href="/astuces-romain/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="page"></span>
            <span class="">Les astuces de Romain</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/cuisine-cc/' %}active{% endif %}"
             href="/cuisine-cc/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="page"></span>
            <span class="">Cuisine CC</span>
          </a>
        </li>

        <!-- Menu Simulateur (flyout) -->
        <li class="group has-flyout">
          <!-- Déclencheur : s'ouvre au survol ou focus clavier -->
          <div class="group-trigger" tabindex="0" aria-haspopup="true" aria-expanded="false">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="doc"></span>
            <span>Simulateur</span>
            <span class="chevron" aria-hidden="true">▸</span>
          </div>
          <!-- Sous-menu flyout, affiché à droite -->
          <ul class="flyout" role="menu" aria-label="Sous-menu Simulateur">
            <li role="none">
              <a class="sc-fqkvVR dMxrQl {% if page.url contains '/simulateur/retraite/' %}active{% endif %}"
                 href="{{ '/simulateur/retraite/' | relative_url }}"
                 role="menuitem" {% if page.url contains '/simulateur/retraite/' %}aria-current="page"{% endif %}>
                Indemnité de départ à la retraite
              </a>
            </li>
            <li role="none">
              <a class="sc-fqkvVR dMxrQl {% if page.url contains '/simulateur/divers/' %}active{% endif %}"
                 href="{{ '/simulateur/divers/' | relative_url }}"
                 role="menuitem" {% if page.url contains '/simulateur/divers/' %}aria-current="page"{% endif %}>
                Divers
              </a>
            </li>
          </ul>
        </li>
        <!-- Fin Menu Simulateur -->

        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/dsn/' %}active{% endif %}"
             href="/dsn/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="file-taxes"></span>
            <span class="">DSN</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/modules/' %}active{% endif %}"
             href="/modules/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="puzzle"></span>
            <span class="">Modules</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/etats-declarations/' %}active{% endif %}"
             href="/etats-declarations/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="chart"></span>
            <span class="">États et déclarations</span>
          </a>
        </li>
        <li>
          <a class="sc-fqkvVR dMxrQl {% if page.url contains '/etats-controle/' %}active{% endif %}"
             href="/etats-controle/">
            <span class="icon-style__StyledIcon-sc-74150e41-0 jEBroz" data-element="checklist"></span>
            <span class="">États de contrôle</span>
          </a>
        </li>
      </ul>
    </aside>

    <!-- CONTENU DES PAGES -->
    <main class="content" role="main">
      {{ content }}
    </main>
  </div>

  <script>
    (function () {
      const toggles = document.querySelectorAll('.menu-toggle');
      // Plier/déplier
      toggles.forEach(btn => {
        const submenuId = btn.getAttribute('aria-controls');
        const submenu = document.getElementById(submenuId);
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          if (submenu) submenu.hidden = expanded;
        });
      });
      // Ouvrir le groupe ET marquer le bouton actif si un sous-lien est actif
      document.querySelectorAll('.submenu a.sc-fqkvVR.dMxrQl.active').forEach(link => {
        const ul = link.closest('.submenu');
        if (!ul) return;
        const btn = document.querySelector(`.menu-toggle[aria-controls="${ul.id}"]`);
        if (btn) {
          btn.setAttribute('aria-expanded', 'true');
          ul.hidden = false;
          btn.classList.add('active');
        }
      });
    })();
  </script>

  <script>
    document.querySelectorAll('.has-flyout').forEach(group => {
      const trig = group.querySelector('.group-trigger');
      const fly = group.querySelector('.flyout');

      const show = () => {
        trig.setAttribute('aria-expanded','true');
        fly.style.display = 'block';
      };
      const hide = () => {
        trig.setAttribute('aria-expanded','false');
        fly.style.display = 'none';
      };

      // Hover / focus maintenus en JS (en plus du CSS) -> robuste aux overrides
      group.addEventListener('mouseenter', show);
      group.addEventListener('mouseleave', hide);
      trig.addEventListener('focus', show);
      fly.addEventListener('focusin', show);
      fly.addEventListener('focusout', () => {
        if (!group.contains(document.activeElement)) hide();
      });

      // Toggle au clic
      trig.addEventListener('click', (e) => {
        e.preventDefault();
        const isOpen = trig.getAttribute('aria-expanded') === 'true';
        isOpen ? hide() : show();
      });

      // Ferme au clic extérieur
      document.addEventListener('click', (e) => {
        if (!group.contains(e.target)) hide();
      });

      // Échap pour fermer
      group.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') hide();
      });

      // Au chargement : si un lien du flyout est actif, ouvrir
      if (fly.querySelector('a.active')) show();
    });
  </script>
</body>
</html>
